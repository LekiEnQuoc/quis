local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local SpawnEvent = ReplicatedStorage:WaitForChild("Connections"):WaitForChild("Spawn")

-- hàm spawn
local function spawnChar()
    print("▶ Auto Spawn...")
    SpawnEvent:FireServer(10)
end

-- hàm farm
local function StartFarm()
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")

    print("✅ Bắt đầu farm...")

    while char.Parent and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0 do
        -- vòng farm của bạn
        for _, point in ipairs(teleportPoints) do
            TeleportAndClick(table.unpack(point))
            task.wait(0.1)
        end
        Uongnuoc()
        task.wait(1)
    end
end

-- khi chết thì spawn lại
player.CharacterRemoving:Connect(function()
    print("⚰ Nhân vật chết, chờ spawn...")
    task.wait(3)
    spawnChar()
end)

-- khi spawn xong thì farm lại
player.CharacterAdded:Connect(function(char)
    task.spawn(function()
        char:WaitForChild("HumanoidRootPart") -- đợi nhân vật load đầy đủ
        task.wait(1) -- thêm 1s để chắc chắn
        StartFarm()
    end)
end)

-- gọi spawn ngay khi script load
spawnChar()
